<stix:STIX_Package xmlns:stix="http://stix.mitre.org/stix-1" xmlns:AIS="http://www.us-cert.gov/STIXMarkingStructure#AISConsentMarking-2" xmlns:AddressObj="http://cybox.mitre.org/objects#AddressObject-2" xmlns:CISCP="http://us-cert.gov/ciscp" xmlns:FileObj="http://cybox.mitre.org/objects#FileObject-2" xmlns:cybox="http://cybox.mitre.org/cybox-2" xmlns:cyboxCommon="http://cybox.mitre.org/common-2" xmlns:cyboxVocabs="http://cybox.mitre.org/default_vocabularies-2" xmlns:indicator="http://stix.mitre.org/Indicator-2" xmlns:marking="http://data-marking.mitre.org/Marking-1" xmlns:simpleMarking="http://data-marking.mitre.org/extensions/MarkingStructure#Simple-1" xmlns:stix-ciq="http://stix.mitre.org/extensions/Identity#CIQIdentity3.0-1" xmlns:stixCommon="http://stix.mitre.org/common-1" xmlns:stixVocabs="http://stix.mitre.org/default_vocabularies-1" xmlns:tlpMarking="http://data-marking.mitre.org/extensions/MarkingStructure#TLP-1" xmlns:xal="urn:oasis:names:tc:ciq:xal:3" xmlns:xnl="urn:oasis:names:tc:ciq:xnl:3" xmlns:xpil="urn:oasis:names:tc:ciq:xpil:3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="CISCP:IB-14-10615A" timestamp="2014-12-08T10:30:40Z" version="1.1.1" xsi:schemaLocation="http://cybox.mitre.org/objects#DomainNameObject-1 http://cybox.mitre.org/XMLSchema/objects/Domain_Name/1.0/Domain_Name_Object.xsd   http://cybox.mitre.org/objects#PortObject-2 http://cybox.mitre.org/XMLSchema/objects/Port/2.1/Port_Object.xsd   http://cybox.mitre.org/common-2 http://cybox.mitre.org/XMLSchema/common/2.1/cybox_common.xsd   http://cybox.mitre.org/objects#WinRegistryKeyObject-2 http://cybox.mitre.org/XMLSchema/objects/Win_Registry_Key/2.1/Win_Registry_Key_Object.xsd   http://stix.mitre.org/default_vocabularies-1 http://stix.mitre.org/XMLSchema/default_vocabularies/1.1.1/stix_default_vocabularies.xsd   http://cybox.mitre.org/objects#FileObject-2 http://cybox.mitre.org/XMLSchema/objects/File/2.1/File_Object.xsd   http://data-marking.mitre.org/Marking-1 http://stix.mitre.org/XMLSchema/data_marking/1.1.1/data_marking.xsd   http://cybox.mitre.org/objects#SocketAddressObject-1 http://cybox.mitre.org/XMLSchema/objects/Socket_Address/1.1/Socket_Address_Object.xsd   http://stix.mitre.org/common-1 http://stix.mitre.org/XMLSchema/common/1.1.1/stix_common.xsd   http://data-marking.mitre.org/extensions/MarkingStructure#TLP-1 http://stix.mitre.org/XMLSchema/extensions/marking/tlp/1.1.1/tlp_marking.xsd   http://stix.mitre.org/stix-1 http://stix.mitre.org/XMLSchema/core/1.1.1/stix_core.xsd   http://cybox.mitre.org/objects#LinkObject-1 http://cybox.mitre.org/XMLSchema/objects/Link/1.1/Link_Object.xsd   http://cybox.mitre.org/objects#AddressObject-2 http://cybox.mitre.org/XMLSchema/objects/Address/2.1/Address_Object.xsd   http://cybox.mitre.org/default_vocabularies-2 http://cybox.mitre.org/XMLSchema/default_vocabularies/2.1/cybox_default_vocabularies.xsd   http://cybox.mitre.org/objects#URIObject-2 http://cybox.mitre.org/XMLSchema/objects/URI/2.1/URI_Object.xsd   http://stix.mitre.org/Indicator-2 http://stix.mitre.org/XMLSchema/indicator/2.1.1/indicator.xsd   http://cybox.mitre.org/objects#EmailMessageObject-2 http://cybox.mitre.org/XMLSchema/objects/Email_Message/2.1/Email_Message_Object.xsd   http://data-marking.mitre.org/extensions/MarkingStructure#Simple-1 http://stix.mitre.org/XMLSchema/extensions/marking/simple/1.1.1/simple_marking.xsd   http://cybox.mitre.org/objects#MutexObject-2 http://cybox.mitre.org/XMLSchema/objects/Mutex/2.1/Mutex_Object.xsd   http://cybox.mitre.org/objects#NetworkConnectionObject-2 http://cybox.mitre.org/XMLSchema/objects/Network_Connection/2.1/Network_Connection_Object.xsd      http://cybox.mitre.org/objects#HTTPSessionObject-2 http://cybox.mitre.org/XMLSchema/objects/HTTP_Session/2.1/HTTP_Session_Object.xsd   http://cybox.mitre.org/cybox-2 http://cybox.mitre.org/XMLSchema/core/2.1/cybox_core.xsd     http://www.us-cert.gov/STIXMarkingStructure#AISConsentMarking-2 http://www.us-cert.gov/sites/default/files/STIX_Namespace/AIS_Bundle_Marking_1.1.1_v1.0.xsd     http://stix.mitre.org/extensions/Identity#CIQIdentity3.0-1 http://stix.mitre.org/XMLSchema/extensions/identity/ciq_3.0/1.1.1/ciq_3.0_identity.xsd     urn:oasis:names:tc:ciq:xpil:3 http://stix.mitre.org/XMLSchema/external/oasis_ciq_3.0/xPIL.xsd"><stix:STIX_Header><stix:Title>Wiper Malware Overwrites Files and MBR</stix:Title><stix:Package_Intent xsi:type="stixVocabs:PackageIntentVocab-1.0">Indicators</stix:Package_Intent><stix:Description>This bulletin serves as an update to IB-14-10615.

On 30 November 2014 a U.S. government department performed analysis of destructive malware used by unidentified actors. This malware has the capability to overwrite a victim host's master boot record (MBR) and all data files. The overwriting of the data files will make it extremely difficult and costly, if not impossible, to recover the data using standard forensic methods. During lab dynamic runs with a 40GB and 8GB hard drive, all files were deleted and the MBR was wiped within an hour of executing the malware.

Analysis of this malware is presented to provide the computer network defense (CND) community with indicators of this malware.

No further information is available at this time from the reporting government department.</stix:Description><stix:Handling><marking:Marking><marking:Controlled_Structure>//node() | //@*</marking:Controlled_Structure><marking:Marking_Structure xsi:type="AIS:AISMarkingStructure"><AIS:Not_Proprietary CISA_Proprietary="false"><AIS:AISConsent consent="EVERYONE"/><AIS:TLPMarking color="AMBER"/></AIS:Not_Proprietary></marking:Marking_Structure><marking:Information_Source><stixCommon:Identity xsi:type="stix-ciq:CIQIdentity3.0InstanceType"><stix-ciq:Specification><xpil:PartyName><xnl:OrganisationName><xnl:NameElement>NCCIC</xnl:NameElement></xnl:OrganisationName></xpil:PartyName><xpil:Addresses><xpil:Address><xal:Country><xal:NameElement xal:NameCode="US" xal:NameCodeType="ISO 3166-1 alpha-2"/></xal:Country><xal:AdministrativeArea><xal:NameElement xal:NameCode="US-DC" xal:NameCodeType="ISO 3166-2"/></xal:AdministrativeArea></xpil:Address></xpil:Addresses><xpil:OrganisationInfo xpil:IndustryType="Information Technology Sector"/></stix-ciq:Specification></stixCommon:Identity></marking:Information_Source></marking:Marking></stix:Handling><stix:Information_Source><stixCommon:Time><cyboxCommon:Produced_Time>2014-12-08T10:30:40Z</cyboxCommon:Produced_Time></stixCommon:Time></stix:Information_Source></stix:STIX_Header><stix:Indicators><stix:Indicator id="CISCP:indicator-f82e7e47-a360-4f78-be30-b9dca733cae9" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Composite_Indicator_Expression operator="OR"><indicator:Indicator idref="CISCP:indicator-27fca65b-7516-4edb-9818-61a3b35dc7f7"/><indicator:Indicator idref="CISCP:indicator-96fdde4a-dd22-4735-88f7-877880239826"/><indicator:Indicator idref="CISCP:indicator-ef765ca6-6582-4465-9d1c-1f7a5978f5b9"/><indicator:Indicator idref="CISCP:indicator-04993d00-f08c-454a-b947-0d4f72472954"/><indicator:Indicator idref="CISCP:indicator-8ab0a1b9-81fc-4646-a95f-46e17ea44260"/><indicator:Indicator idref="CISCP:indicator-845211e7-81da-4d54-a3b8-dd3a241d1709"/><indicator:Indicator idref="CISCP:indicator-42e63a40-efb2-46ab-9f2d-f5174a321aa1"/><indicator:Indicator idref="CISCP:indicator-8cf3bcb1-341e-4bc6-8769-cafe56afa1c7"/><indicator:Indicator idref="CISCP:indicator-0a5efd4e-2a25-4b04-a319-ed36c2009f92"/></indicator:Composite_Indicator_Expression></stix:Indicator><stix:Indicator id="CISCP:indicator-27fca65b-7516-4edb-9818-61a3b35dc7f7" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>PE Header information:
PE Compile Time: 2014-11-22 00:06:54
Language pack of resource section: Korean

The original filename of this file is unknown, but it was likely "diskpartmg16.exe". This file creates the destructive malware, "igfxtrayex.exe". When the file was executed, it started a second instance of itself with "-i" as an argument, then terminated. 

The second instance of the file installed itself as the "WinsSchMgmt" service with "-k" as a command line argument, started the service, then terminated.
The "WinsSchMgmt" service executed the file with "-k" as an argument, which started another instance of the file using "-s" as an argument.

The "-s" instance created and executed igfxtrayex.exe, created net_ver.dat, and began generating network traffic over TCP ports 445 and 139 to IP addresses contained in the file net_ver.dat.

The "-s" instance of "WinsSchMgmt" service created by "diskpartmg16.exe" (MD5 D1C27EE7CE18675974EDF42D4EEA25C6) was observed during analysis attempting network traffic sent on ports 445 and 139 to the IP addresses contained in the file net_ver.dat:

An example of network traffic on port 445 follows:
00000000 00 00 00 85 ff 53 4d 42 72 00 00 00 00 18 53 c8 .....SMB r.....S.
00000010 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ff fe ........ ........
00000020 00 00 00 00 00 62 00 02 50 43 20 4e 45 54 57 4f .....b.. PC NETWO
00000030 52 4b 20 50 52 4f 47 52 41 4d 20 31 2e 30 00 02 RK PROGR AM 1.0..
00000040 4c 41 4e 4d 41 4e 31 2e 30 00 02 57 69 6e 64 6f LANMAN1. 0..Windo
00000050 77 73 20 66 6f 72 20 57 6f 72 6b 67 72 6f 75 70 ws for W orkgroup
00000060 73 20 33 2e 31 61 00 02 4c 4d 31 2e 32 58 30 30 s 3.1a.. LM1.2X00
00000070 32 00 02 4c 41 4e 4d 41 4e 32 2e 31 00 02 4e 54 2..LANMA N2.1..NT
00000080 20 4c 4d 20 30 2e 31 32 00 LM 0.12 .
137 bytes

The only traffic observed going to port 139 were SYN packets.

The network activity is likely an attempt at reconnaissance and propagation within the compromised host's network.

The following files were added:
C:\Documents and Settings\User\Desktop\igfxtrayex.exe
C:\WINDOWS\system32\net_ver.dat

The following strings of interest were in this file:
---BEGIN STRINGS---
recdiscm32.exe
taskhosts64.exe
taskchg16.exe
rdpshellex32.exe
mobsynclm64.exe
comon32.exe
diskpartmg16.exe
dpnsvr16.exe
expandmn32.exe
hwrcompsvc64.exe
cmd.exe /q /c net share shared$ /delete
\\%s\admin$\syswow64
\\%s\admin$\system32
cmd.exe /q /c net share shared$=%SystemRoot%
cmd.exe /q /c net share shared$=%SystemRoot% /GRANT:everyone,FULL
RasSecruity
RasMgrp
cmd.exe /c wmic.exe /node:"%s" /user:"%s" /password:"%s" PROCESS CALL CREATE "%s" &gt; %s
WinsSchMgmt
Windows Schedule Management Service
---END STRINGS---</indicator:Description><indicator:Observable id="CISCP:Observable-7ca9724f-a71f-4092-9b06-caabb4eb4768"><cybox:Object id="CISCP:Object-a540f904-0ac0-4814-9fd6-51011d8636b4"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">diskpartmg16.exe</FileObj:File_Name><FileObj:Size_In_Bytes condition="Equals">268579</FileObj:Size_In_Bytes><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">D1C27EE7CE18675974EDF42D4EEA25C6</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-11-30T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-96fdde4a-dd22-4735-88f7-877880239826" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>This is a configuration file containing what appear to be hostnames, IP addresses, and the number 2. Entries in the file have the structure "HOSTNAME|IP Address|2". The IP addresses in this file correspond with the IP addresses listed under the file with MD5 hash D1C27EE7CE18675974EDF42D4EEA25C6.

The "-s" instance of "WinsSchMgmt" service created by "diskpartmg16.exe" (MD5 D1C27EE7CE18675974EDF42D4EEA25C6) was observed during analysis attempting network traffic sent on ports 445 and 139 to the IP addresses contained in the file net_ver.dat:

An example of network traffic on port 445 follows:
00000000 00 00 00 85 ff 53 4d 42 72 00 00 00 00 18 53 c8 .....SMB r.....S.
00000010 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ff fe ........ ........
00000020 00 00 00 00 00 62 00 02 50 43 20 4e 45 54 57 4f .....b.. PC NETWO
00000030 52 4b 20 50 52 4f 47 52 41 4d 20 31 2e 30 00 02 RK PROGR AM 1.0..
00000040 4c 41 4e 4d 41 4e 31 2e 30 00 02 57 69 6e 64 6f LANMAN1. 0..Windo
00000050 77 73 20 66 6f 72 20 57 6f 72 6b 67 72 6f 75 70 ws for W orkgroup
00000060 73 20 33 2e 31 61 00 02 4c 4d 31 2e 32 58 30 30 s 3.1a.. LM1.2X00
00000070 32 00 02 4c 41 4e 4d 41 4e 32 2e 31 00 02 4e 54 2..LANMA N2.1..NT
00000080 20 4c 4d 20 30 2e 31 32 00 LM 0.12 .
137 bytes

The only traffic observed going to port 139 were SYN packets.

The network activity is likely an attempt at reconnaissance and propagation within the compromised host's network.</indicator:Description><indicator:Observable id="CISCP:Observable-eae4b743-f38e-4cdf-91e5-9e213e5b493d"><cybox:Object id="CISCP:Object-f0aa3ce5-674a-43f7-b36e-c50cc92c9098"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">net_ver.dat</FileObj:File_Name><FileObj:File_Path condition="Equals">C:\WINDOWS\system32</FileObj:File_Path><FileObj:Size_In_Bytes condition="Equals">4572</FileObj:Size_In_Bytes><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">93BC819011B2B3DA8487F964F29EB934</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-11-30T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-ef765ca6-6582-4465-9d1c-1f7a5978f5b9" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>PE Header info:
PE Compile Time: 2014-11-24 04:11:08
Language pack of resource section: Korean

This file is destructive malware; a disk wiper with network beacon capabilities. If "igfxtrayex.exe" is run with no parameters, it creates and starts a copy of itself with the -i argument. The result of this is that after 10 minutes, "igfxtrayex.exe" makes three copies of itself and places them in the same directory it was executed from. These copies are named according to the format "taskhostXX.exe" (where X is a randomly generated ASCII character). These copies are then executed, each with a different argument (one being "-m", one being "-d" and the other "-w"). Network connection attempts are made to one of three hard-coded IP addresses in a random order to either port 8080 or 8000. If a connection to that IP address cannot be made, it attempts to connect to another of the three IP addresses, until connections to all three IP addresses have been attempted. The following command-line string is then executed: "cmd.exe /c net stop MSExchangeIS /y". A 120 minute (2 hour) sleep command is issued after which the computer is shutdown and rebooted.
 
A summary of the command-line arguments is provided here for clarity:
-i: Installs and starts the "brmgmtsvc" service, description "Backup and Restore Management Service", with the -k argument.
-k: Starts "brmgmtsvc" service. After 10 minutes, copies itself to 3 copies of "igfxtrayex.exe" renamed with the following format "taskhostXX.exe" (where X is a randomly generated ASCII char) and appends one of three parameters and executes in the order of "taskhostXX.exe -w", "taskhostXX.exe -m", "taskhostXX.exe -d".
-w: Gets "iissvr.exe" from resource section, drops it to "C:\WINDOWS\iissvr.exe", and executes it.
-m: Creates 32-bit and 64-bit versions ("usbdrv3_32bit.sys" and "usbdrv3_64bit.sys") of a drive wiper from the resource section. Creates a service named "usbdrv3" with description "USB 3.0 Host Controller". The service controls a driver which allows direct access to the physical drive. This service provides the functionality to overwrite the MBR and once the computer is rebooted, it is inoperable.
-d: Executes overwrite and deletion of select files on the operating system.
Network beacon traffic went to the following three IP addresses over TCP ports 8000 and 8080:
88.53.215.64
217.96.33.164
203.131.222.102

While the method used to overwrite and delete files on network and hard disk drives uses standard windows APIs, it is important to note that the author of this malware created logic which checks the file extension of each file for ".dll" and ".exe" and does not overwrite these files, but does delete them. If a file extension does not end in ".dll" or ".exe" the file is overwritten before deletion occurs. This renders all non-binary files with all file extensions except ".dll" and ".exe" unrecoverable without significant forensic effort. The logic of not overwriting files with ".exe" and ".dll" extensions could be a custom optimization to ensure files are quickly overwritten and deleted to ensure maximum destruction of intellectual property in the quickest manner. The logic for deletion also checks the directory and does not overwrite or delete any files in "C:\Windows" and "C:\Program Files". These file paths are not hard-coded into the malware, but rather are the result of calls to the Windows API functions GetWindowsDirectory and SHGetSpecialFolderPath respectively. Consequently, different versions of Windows may return different "protected" directories (such as "C:\Program Files (x64)" for 64-bit versions of Windows). This logic of not overwriting ".dll" and ".exe" files before deleting them and also not deleting or overwriting any files in the  "C:\Windows" and "C:\Program Files" directories can be used loosely as an author fingerprint to distinguish this wiper and possibly future versions of this wiper from wipers developed by other authors.

The 2-hour timer while files are being overwritten before the computer is rebooted to an inoperable state could be a way to allow for as many files to be deleted as possible. During lab dynamic runs with a 40GB and 8GB hard drive, all files were deleted and the MBR was wiped within an hour of executing the malware.</indicator:Description><indicator:Observable id="CISCP:Observable-db008b0d-f4f3-493a-9148-78b443b6eec9"><cybox:Object id="CISCP:Object-310e84c8-5477-4e65-801b-39790398712a"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">igfxtrayex.exe</FileObj:File_Name><FileObj:File_Path condition="Equals">C:\Documents and Settings\User\Desktop</FileObj:File_Path><FileObj:Size_In_Bytes condition="Equals">249856</FileObj:Size_In_Bytes><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">760c35a80d758f032d02cf4db12d3e55</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-11-30T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-04993d00-f08c-454a-b947-0d4f72472954" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">C2</indicator:Type><indicator:Description>igfxtrayex.exe attempted network traffic to the following three IP addresses over TCP ports 8000 and 8080:
88.53.215.64
217.96.33.164
203.131.222.102

Sample beacons (in HEX) using different victim hostnames are presented below:
--- SAMPLE BEACON 1 ---
00000000  28 00 16 0b 0b 16 56 49  43 54 49 4d 2d 4d 41 43 (.....VI CTIM-MAC
00000010  48 49 4e 45 00 71 80 6b  ab 71 ff ff ff ff 63 6b HINE.q.k .q....ck
00000020  ab 71 98 13 40 00 04 00  00 00                   .q..@... ..
        
--- SAMPLE BEACON 2 ---
00000000  28 00 16 0b 0b 1e 49 41  4d 50 41 57 4e 45 44 00 (.....IA MPAWNED.
00000010  a6 00 c7 24 ac 71 80 6b  ab 71 ff ff ff ff 63 6b ...$.q.k .q....ck
00000020  ab 71 98 13 40 00 04 00  00 00                   .q..@... ..
--- SAMPLE BEACON 3 ---
00000000  28 00 01 01 01 02 41 42  43 44 45 46 47 48 49 4a (.....AB CDEFGHIJ
00000010  4b 4c 4d 4e 4f 00 80 6b  ab 71 ff ff ff ff 63 6b KLMNO..k .q....ck
00000020  ab 71 98 13 40 00 04 00  00 00                   .q..@... ..
    
Breaking out the first example beacon, analysis of the format of the payload follows:    
Bytes 1-2: 28 00 -&gt; These bytes are potentially the size of the payload of the beacon packet. In all observed beacons, the payload of the beacon packet was 42 bytes. Taking these two bytes (0x0028 if it is in little endian) yields a payload size following these two bytes of 40 bytes (or hex 0x28).
Bytes 3-6: 16 0b 0b 16 -&gt; These bytes correspond to the IP address of the victim machine (22.11.11.22 in this case - this is the static IP address of the workstation used for this analysis).
Bytes 7-20: 56 49 43 54 49 4d 2d 4d 41 43 48 49 4e 45 -&gt; These bytes correspond to the hostname (VICTIM-MACHINE in this case) - a maximum of 15 characters, corresponding to the maximum size of a NetBIOS hostname.
Bytes 21-40: 80 6b ab 71 ff ff ff ff 63 6b ab 71 98 13 40 00 04 00 00 00 -&gt; These bytes may be exfiltration or if determined to be hard-coded or constant, could be used to develop network signatures. In all testing performed to date, the 0xff bytes have been constant.</indicator:Description><indicator:Observable id="CISCP:Observable-169d8ff6-579f-44e1-8961-53dbea80d498"><cybox:Object id="CISCP:Object-928a6100-48c4-42a7-b339-a0c5850338b8"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">88.53.215.64</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Command and Control" ordinality="6" phase_id="stix:KillChainPhase-d6dc32b9-2538-4951-8733-3cb9ef1daae2"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-11-30T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-8ab0a1b9-81fc-4646-a95f-46e17ea44260" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">C2</indicator:Type><indicator:Description>igfxtrayex.exe attempted network traffic to the following three IP addresses over TCP ports 8000 and 8080:
88.53.215.64
217.96.33.164
203.131.222.102

Sample beacons (in HEX) using different victim hostnames are presented below:
--- SAMPLE BEACON 1 ---
00000000  28 00 16 0b 0b 16 56 49  43 54 49 4d 2d 4d 41 43 (.....VI CTIM-MAC
00000010  48 49 4e 45 00 71 80 6b  ab 71 ff ff ff ff 63 6b HINE.q.k .q....ck
00000020  ab 71 98 13 40 00 04 00  00 00                   .q..@... ..
        
--- SAMPLE BEACON 2 ---
00000000  28 00 16 0b 0b 1e 49 41  4d 50 41 57 4e 45 44 00 (.....IA MPAWNED.
00000010  a6 00 c7 24 ac 71 80 6b  ab 71 ff ff ff ff 63 6b ...$.q.k .q....ck
00000020  ab 71 98 13 40 00 04 00  00 00                   .q..@... ..
--- SAMPLE BEACON 3 ---
00000000  28 00 01 01 01 02 41 42  43 44 45 46 47 48 49 4a (.....AB CDEFGHIJ
00000010  4b 4c 4d 4e 4f 00 80 6b  ab 71 ff ff ff ff 63 6b KLMNO..k .q....ck
00000020  ab 71 98 13 40 00 04 00  00 00                   .q..@... ..
    
Breaking out the first example beacon, analysis of the format of the payload follows:    
Bytes 1-2: 28 00 -&gt; These bytes are potentially the size of the payload of the beacon packet. In all observed beacons, the payload of the beacon packet was 42 bytes. Taking these two bytes (0x0028 if it is in little endian) yields a payload size following these two bytes of 40 bytes (or hex 0x28).
Bytes 3-6: 16 0b 0b 16 -&gt; These bytes correspond to the IP address of the victim machine (22.11.11.22 in this case - this is the static IP address of the workstation used for this analysis).
Bytes 7-20: 56 49 43 54 49 4d 2d 4d 41 43 48 49 4e 45 -&gt; These bytes correspond to the hostname (VICTIM-MACHINE in this case) - a maximum of 15 characters, corresponding to the maximum size of a NetBIOS hostname.
Bytes 21-40: 80 6b ab 71 ff ff ff ff 63 6b ab 71 98 13 40 00 04 00 00 00 -&gt; These bytes may be exfiltration or if determined to be hard-coded or constant, could be used to develop network signatures. In all testing performed to date, the 0xff bytes have been constant.</indicator:Description><indicator:Observable id="CISCP:Observable-eeab1c29-7c2e-4bf5-b56d-5c85128bc1c6"><cybox:Object id="CISCP:Object-6144cced-1844-4f3f-b39b-be63bfff873b"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">217.96.33.164</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-11-30T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-845211e7-81da-4d54-a3b8-dd3a241d1709" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">C2</indicator:Type><indicator:Description>igfxtrayex.exe attempted network traffic to the following three IP addresses over TCP ports 8000 and 8080:
88.53.215.64
217.96.33.164
203.131.222.102

Sample beacons (in HEX) using different victim hostnames are presented below:
--- SAMPLE BEACON 1 ---
00000000  28 00 16 0b 0b 16 56 49  43 54 49 4d 2d 4d 41 43 (.....VI CTIM-MAC
00000010  48 49 4e 45 00 71 80 6b  ab 71 ff ff ff ff 63 6b HINE.q.k .q....ck
00000020  ab 71 98 13 40 00 04 00  00 00                   .q..@... ..
        
--- SAMPLE BEACON 2 ---
00000000  28 00 16 0b 0b 1e 49 41  4d 50 41 57 4e 45 44 00 (.....IA MPAWNED.
00000010  a6 00 c7 24 ac 71 80 6b  ab 71 ff ff ff ff 63 6b ...$.q.k .q....ck
00000020  ab 71 98 13 40 00 04 00  00 00                   .q..@... ..
--- SAMPLE BEACON 3 ---
00000000  28 00 01 01 01 02 41 42  43 44 45 46 47 48 49 4a (.....AB CDEFGHIJ
00000010  4b 4c 4d 4e 4f 00 80 6b  ab 71 ff ff ff ff 63 6b KLMNO..k .q....ck
00000020  ab 71 98 13 40 00 04 00  00 00                   .q..@... ..
    
Breaking out the first example beacon, analysis of the format of the payload follows:    
Bytes 1-2: 28 00 -&gt; These bytes are potentially the size of the payload of the beacon packet. In all observed beacons, the payload of the beacon packet was 42 bytes. Taking these two bytes (0x0028 if it is in little endian) yields a payload size following these two bytes of 40 bytes (or hex 0x28).
Bytes 3-6: 16 0b 0b 16 -&gt; These bytes correspond to the IP address of the victim machine (22.11.11.22 in this case - this is the static IP address of the workstation used for this analysis).
Bytes 7-20: 56 49 43 54 49 4d 2d 4d 41 43 48 49 4e 45 -&gt; These bytes correspond to the hostname (VICTIM-MACHINE in this case) - a maximum of 15 characters, corresponding to the maximum size of a NetBIOS hostname.
Bytes 21-40: 80 6b ab 71 ff ff ff ff 63 6b ab 71 98 13 40 00 04 00 00 00 -&gt; These bytes may be exfiltration or if determined to be hard-coded or constant, could be used to develop network signatures. In all testing performed to date, the 0xff bytes have been constant.</indicator:Description><indicator:Observable id="CISCP:Observable-eb021a64-2817-4b54-b1d1-4ee3b066dd6b"><cybox:Object id="CISCP:Object-c8c51e03-27bb-4c68-96e4-f6b5c93c504c"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">203.131.222.102</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Command and Control" ordinality="6" phase_id="stix:KillChainPhase-d6dc32b9-2538-4951-8733-3cb9ef1daae2"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-11-30T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-42e63a40-efb2-46ab-9f2d-f5174a321aa1" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>PE Compile Time: 2014-11-13 02:05:35
Language pack of resource section: Korean

When executed, this file starts a listener on localhost port 80. It has 3 files contained in the resource section, all xor'd with 0x63. One of the files is an HTML file with ransom demands and warning about exfiltrated content claiming to be located at 5 URLs. The other two files are a .wav sound file that is played and an image file that is shown as part of the webpage.</indicator:Description><indicator:Observable id="CISCP:Observable-21a9def8-7d72-487a-b9f9-0ebcf7212996"><cybox:Object id="CISCP:Object-0a7856f8-3bd9-4743-a06b-e120b31fa7dc"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">iissvr.exe</FileObj:File_Name><FileObj:Size_In_Bytes condition="Equals">114688</FileObj:Size_In_Bytes><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">e1864a55d5ccb76af4bf7a0ae16279ba</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-11-30T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-8cf3bcb1-341e-4bc6-8769-cafe56afa1c7" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>PE Compile Time: 2009-08-21 06:05:32
This is a .SYS file, and is a commercially available tool that allows read/write access to files and raw disk sectors for user mode applications in Windows 2000, XP, 2003, Vista, 2008 (32-bit). It is created from resource ID 0x81 of "igfxtrayex.exe".</indicator:Description><indicator:Observable id="CISCP:Observable-f1f8033c-df7f-48f0-b28e-58c58073a433"><cybox:Object id="CISCP:Object-ead0c82f-9dd4-4d21-a0d6-f1169c4f115e"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">usbdrv3_32bit.sys</FileObj:File_Name><FileObj:Size_In_Bytes condition="Equals">24280</FileObj:Size_In_Bytes><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">6AEAC618E29980B69721158044C2E544</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Delivery" ordinality="3" phase_id="stix:KillChainPhase-79a0e041-9d5f-49bb-ada4-8322622b162d"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-11-30T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-0a5efd4e-2a25-4b04-a319-ed36c2009f92" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>PE Compile Time: 2009-08-21 06:05:35

This SYS file is a commercially available tool that allows read/write access to files and raw disk sectors for user mode applications in Windows 2000, XP, 2003, Vista, 2008 (64-bit). It is created from resource ID 0x83 of "igfxtrayex.exe".

The 64-bit version of the driver, usbdrv3_64bit.sys, was seen in the SHAMOON malware in 2012. The driver is a legitimate driver (known as elrawdisk.sys) developed by the UK-based company EldoS Corporation as part of their RawDisk product. It allows user-mode applications to directly access files, disks and partitions of the disks, while bypassing the security limitations of the Windows OS. The use of this driver is not an indication that the author of this wiper and SHAMOON's author are the same.</indicator:Description><indicator:Observable id="CISCP:Observable-2a215ee1-f4ad-420f-b633-caa5780ce8e6"><cybox:Object id="CISCP:Object-78fdb329-93a8-4f1f-8d2c-5d65189bda6e"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">usbdrv3_64bit.sys</FileObj:File_Name><FileObj:Size_In_Bytes condition="Equals">28120</FileObj:Size_In_Bytes><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">86E212B7FC20FC406C692400294073FF</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-11-30T00:00:00"/></indicator:Sightings></stix:Indicator></stix:Indicators><stix:TTPs><stix:Kill_Chains><stixCommon:Kill_Chain definer="LMCO" id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" name="LM Cyber Kill Chain" number_of_phases="7" reference="http://www.lockheedmartin.com/content/dam/lockheed/data/corporate/documents/LM-White-Paper-Intel-Driven-Defense.pdf"><stixCommon:Kill_Chain_Phase name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/><stixCommon:Kill_Chain_Phase name="Weaponization" ordinality="2" phase_id="stix:KillChainPhase-445b4827-3cca-42bd-8421-f2e947133c16"/><stixCommon:Kill_Chain_Phase name="Delivery" ordinality="3" phase_id="stix:KillChainPhase-79a0e041-9d5f-49bb-ada4-8322622b162d"/><stixCommon:Kill_Chain_Phase name="Exploitation" ordinality="4" phase_id="stix:KillChainPhase-f706e4e7-53d8-44ef-967f-81535c9db7d0"/><stixCommon:Kill_Chain_Phase name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/><stixCommon:Kill_Chain_Phase name="Command and Control" ordinality="6" phase_id="stix:KillChainPhase-d6dc32b9-2538-4951-8733-3cb9ef1daae2"/><stixCommon:Kill_Chain_Phase name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/></stixCommon:Kill_Chain></stix:Kill_Chains></stix:TTPs></stix:STIX_Package>