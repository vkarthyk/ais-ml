<stix:STIX_Package xmlns:stix="http://stix.mitre.org/stix-1" xmlns:AIS="http://www.us-cert.gov/STIXMarkingStructure#AISConsentMarking-2" xmlns:CISCP="http://us-cert.gov/ciscp" xmlns:FileObj="http://cybox.mitre.org/objects#FileObject-2" xmlns:URIObj="http://cybox.mitre.org/objects#URIObject-2" xmlns:cybox="http://cybox.mitre.org/cybox-2" xmlns:cyboxCommon="http://cybox.mitre.org/common-2" xmlns:cyboxVocabs="http://cybox.mitre.org/default_vocabularies-2" xmlns:indicator="http://stix.mitre.org/Indicator-2" xmlns:marking="http://data-marking.mitre.org/Marking-1" xmlns:simpleMarking="http://data-marking.mitre.org/extensions/MarkingStructure#Simple-1" xmlns:stix-ciq="http://stix.mitre.org/extensions/Identity#CIQIdentity3.0-1" xmlns:stixCommon="http://stix.mitre.org/common-1" xmlns:stixVocabs="http://stix.mitre.org/default_vocabularies-1" xmlns:tlpMarking="http://data-marking.mitre.org/extensions/MarkingStructure#TLP-1" xmlns:xal="urn:oasis:names:tc:ciq:xal:3" xmlns:xnl="urn:oasis:names:tc:ciq:xnl:3" xmlns:xpil="urn:oasis:names:tc:ciq:xpil:3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="CISCP:IB-15-10066" timestamp="2015-02-10T16:23:47Z" version="1.1.1" xsi:schemaLocation="http://cybox.mitre.org/objects#DomainNameObject-1 http://cybox.mitre.org/XMLSchema/objects/Domain_Name/1.0/Domain_Name_Object.xsd   http://cybox.mitre.org/objects#PortObject-2 http://cybox.mitre.org/XMLSchema/objects/Port/2.1/Port_Object.xsd   http://cybox.mitre.org/common-2 http://cybox.mitre.org/XMLSchema/common/2.1/cybox_common.xsd   http://cybox.mitre.org/objects#WinRegistryKeyObject-2 http://cybox.mitre.org/XMLSchema/objects/Win_Registry_Key/2.1/Win_Registry_Key_Object.xsd   http://stix.mitre.org/default_vocabularies-1 http://stix.mitre.org/XMLSchema/default_vocabularies/1.1.1/stix_default_vocabularies.xsd   http://cybox.mitre.org/objects#FileObject-2 http://cybox.mitre.org/XMLSchema/objects/File/2.1/File_Object.xsd   http://data-marking.mitre.org/Marking-1 http://stix.mitre.org/XMLSchema/data_marking/1.1.1/data_marking.xsd   http://cybox.mitre.org/objects#SocketAddressObject-1 http://cybox.mitre.org/XMLSchema/objects/Socket_Address/1.1/Socket_Address_Object.xsd   http://stix.mitre.org/common-1 http://stix.mitre.org/XMLSchema/common/1.1.1/stix_common.xsd   http://data-marking.mitre.org/extensions/MarkingStructure#TLP-1 http://stix.mitre.org/XMLSchema/extensions/marking/tlp/1.1.1/tlp_marking.xsd   http://stix.mitre.org/stix-1 http://stix.mitre.org/XMLSchema/core/1.1.1/stix_core.xsd   http://cybox.mitre.org/objects#LinkObject-1 http://cybox.mitre.org/XMLSchema/objects/Link/1.1/Link_Object.xsd   http://cybox.mitre.org/objects#AddressObject-2 http://cybox.mitre.org/XMLSchema/objects/Address/2.1/Address_Object.xsd   http://cybox.mitre.org/default_vocabularies-2 http://cybox.mitre.org/XMLSchema/default_vocabularies/2.1/cybox_default_vocabularies.xsd   http://cybox.mitre.org/objects#URIObject-2 http://cybox.mitre.org/XMLSchema/objects/URI/2.1/URI_Object.xsd   http://stix.mitre.org/Indicator-2 http://stix.mitre.org/XMLSchema/indicator/2.1.1/indicator.xsd   http://cybox.mitre.org/objects#EmailMessageObject-2 http://cybox.mitre.org/XMLSchema/objects/Email_Message/2.1/Email_Message_Object.xsd   http://data-marking.mitre.org/extensions/MarkingStructure#Simple-1 http://stix.mitre.org/XMLSchema/extensions/marking/simple/1.1.1/simple_marking.xsd   http://cybox.mitre.org/objects#MutexObject-2 http://cybox.mitre.org/XMLSchema/objects/Mutex/2.1/Mutex_Object.xsd   http://cybox.mitre.org/objects#NetworkConnectionObject-2 http://cybox.mitre.org/XMLSchema/objects/Network_Connection/2.1/Network_Connection_Object.xsd      http://cybox.mitre.org/objects#HTTPSessionObject-2 http://cybox.mitre.org/XMLSchema/objects/HTTP_Session/2.1/HTTP_Session_Object.xsd   http://cybox.mitre.org/cybox-2 http://cybox.mitre.org/XMLSchema/core/2.1/cybox_core.xsd     http://www.us-cert.gov/STIXMarkingStructure#AISConsentMarking-2 http://www.us-cert.gov/sites/default/files/STIX_Namespace/AIS_Bundle_Marking_1.1.1_v1.0.xsd     http://stix.mitre.org/extensions/Identity#CIQIdentity3.0-1 http://stix.mitre.org/XMLSchema/extensions/identity/ciq_3.0/1.1.1/ciq_3.0_identity.xsd     urn:oasis:names:tc:ciq:xpil:3 http://stix.mitre.org/XMLSchema/external/oasis_ciq_3.0/xPIL.xsd"><stix:STIX_Header><stix:Title>PCCLIENT Malware Installed After Web Shell Compromise</stix:Title><stix:Package_Intent xsi:type="stixVocabs:PackageIntentVocab-1.0">Indicators - Network Activity</stix:Package_Intent><stix:Description>On 17 December 2014, the malware known as PCCLIENT (or PHOTO) was observed on a network of a U.S. Government Department. The malware 64.dll (MD5: F233CF592FF62DA22D71263D5ECCCB39) called back to http://14.206.231.13:443/Query.asp.</stix:Description><stix:Handling><marking:Marking><marking:Controlled_Structure>//node() | //@*</marking:Controlled_Structure><marking:Marking_Structure xsi:type="AIS:AISMarkingStructure"><AIS:Not_Proprietary CISA_Proprietary="false"><AIS:AISConsent consent="EVERYONE"/><AIS:TLPMarking color="AMBER"/></AIS:Not_Proprietary></marking:Marking_Structure><marking:Information_Source><stixCommon:Identity xsi:type="stix-ciq:CIQIdentity3.0InstanceType"><stix-ciq:Specification><xpil:PartyName><xnl:OrganisationName><xnl:NameElement>NCCIC</xnl:NameElement></xnl:OrganisationName></xpil:PartyName><xpil:Addresses><xpil:Address><xal:Country><xal:NameElement xal:NameCode="US" xal:NameCodeType="ISO 3166-1 alpha-2"/></xal:Country><xal:AdministrativeArea><xal:NameElement xal:NameCode="US-DC" xal:NameCodeType="ISO 3166-2"/></xal:AdministrativeArea></xpil:Address></xpil:Addresses><xpil:OrganisationInfo xpil:IndustryType="Information Technology Sector"/></stix-ciq:Specification></stixCommon:Identity></marking:Information_Source></marking:Marking></stix:Handling><stix:Information_Source><stixCommon:Time><cyboxCommon:Produced_Time>2015-02-10T16:23:47Z</cyboxCommon:Produced_Time></stixCommon:Time></stix:Information_Source></stix:STIX_Header><stix:Indicators><stix:Indicator id="CISCP:indicator-349dd9cf-5362-4e44-9641-0c958aa7931a" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Composite_Indicator_Expression operator="OR"><indicator:Indicator idref="CISCP:indicator-7d62a3da-8a13-4dfb-8a33-712e4aa4015f"/><indicator:Indicator idref="CISCP:indicator-eac635ab-5052-40cf-b345-909f1d7dae53"/></indicator:Composite_Indicator_Expression></stix:Indicator><stix:Indicator id="CISCP:indicator-7d62a3da-8a13-4dfb-8a33-712e4aa4015f" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">Malware Artifacts</indicator:Type><indicator:Description>PE Compile Time: 2014-11-12 11:40:00

The file 64.dll is the DoorDLL implant. This malware is also known as PCCLIENT or PHOTO.

On 17 December 2014, attackers established an interactive session to compromise a system on a U.S. Government network using a China Chopper web shell backdoor in the directory "C:\Inetpub\[REDACTED] Domain 1\group\" and the file flashobject.aspx. Through the web shell, attackers issued systems level commands to run on a second compromised host. Operating out of the directory on the first host, the attackers performed directory listings of multiple folders and shared drives on the second host including:
C$
C$\windows\tasks
C$\windows\system 

The attackers then successfully scheduled the task 2XDevRedir to run through the command "schtasks /s Host # 2 /run /tn2XDevRedir /u [User Account #1] /p [password]".

The attacker then searched several folders on the second host's "admin$\system32\" directory for files beginning with the letters "wmi". The search found a file named 'WmiSrvSE.exe' with a last modified date of 11/19/2014 07:58 PM with a file size of 236,544 bytes. The attacker then deleted this file.

Operating out of the "C:\Inetpub\[REDACTED] Domain 1\group\" directory on the first host, the attacker then uploaded the file 64.dll on 12/17/2014 02:28 AM to the directory "C:\ProgramData\" on the first host and confirmed it was successfully transferred. 

The attacker performed the command "net use" to confirm access to the second host's network shared drives. The file 64.dll was then copied into the directory "C:\Windows\temp" on the second host and then scheduled to run via the command "at \\host#2 04:28 regsvr32.exe c:\windows\temp\64.dll". 

According to the report, it was unclear if 64.dll was executed on the victim host. These attackers have maintained a presence on the compromised network for several months and likely obtained legitimate credentials for continued access. These attackers previously used the HiKit A malware to maintain access into the network. According to the report they use a variety of tools to compromise systems. They will likely install multiple backdoors on multiple hosts for redundancy and to maintain persistence.

The implant called back by using unencrypted HTTP GET requests over TCP port 443 to the IP address 14.206.231.13 registered in South Korea.</indicator:Description><indicator:Observable id="CISCP:Observable-e038e797-2ea7-4c33-9c98-0077d8d93dd3"><cybox:Object id="CISCP:Object-70b362a8-1a2a-40c1-a2b9-e4c62a79bc46"><cybox:Properties xsi:type="FileObj:FileObjectType"><FileObj:File_Name condition="Equals">64.dll</FileObj:File_Name><FileObj:Size_In_Bytes condition="Equals">88576</FileObj:Size_In_Bytes><FileObj:Hashes><cyboxCommon:Hash><cyboxCommon:Type condition="Equals" xsi:type="cyboxVocabs:HashNameVocab-1.0">MD5</cyboxCommon:Type><cyboxCommon:Simple_Hash_Value condition="Equals">F233CF592FF62DA22D71263D5ECCCB39</cyboxCommon:Simple_Hash_Value></cyboxCommon:Hash></FileObj:Hashes></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-17T00:00:00"/></indicator:Sightings></stix:Indicator><stix:Indicator id="CISCP:indicator-eac635ab-5052-40cf-b345-909f1d7dae53" version="2.1.1" xsi:type="indicator:IndicatorType"><indicator:Type xsi:type="stixVocabs:IndicatorTypeVocab-1.1">C2</indicator:Type><indicator:Description>The following GET request was sent by the malware:

GET /Query.asp?loginid=112037 HTTP/1.1
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)
Host: 14.206.231.13:443
Cache-Control: no-cache
Pragma: no-cache
Connection: Keep-Alive

A Snort signature was written to potentially detect this DoorDLL network traffic:

alert tcp any any -&gt; any 443 (msg:"DoorDLL Beacon To Server";
flow:to_server,established; content:"GET"; content:"Query.asp?loginid="; sid:1; rev:1;)</indicator:Description><indicator:Observable id="CISCP:Observable-f78816a4-7f29-4e52-9622-7215794c2a16"><cybox:Object id="CISCP:Object-4742965c-efe1-41fb-817b-cf64d100798e"><cybox:Properties type="URL" xsi:type="URIObj:URIObjectType"><URIObj:Value condition="Equals">http://14.206.231.13:443/Query.asp</URIObj:Value></cybox:Properties></cybox:Object></indicator:Observable><indicator:Kill_Chain_Phases><stixCommon:Kill_Chain_Phase kill_chain_id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" kill_chain_name="LM Cyber Kill Chain" name="Command and Control" ordinality="6" phase_id="stix:KillChainPhase-d6dc32b9-2538-4951-8733-3cb9ef1daae2"/></indicator:Kill_Chain_Phases><indicator:Sightings sightings_count="1"><indicator:Sighting timestamp="2014-12-17T00:00:00"/></indicator:Sightings></stix:Indicator></stix:Indicators><stix:TTPs><stix:Kill_Chains><stixCommon:Kill_Chain definer="LMCO" id="stix:KillChain-af3e707f-2fb9-49e5-8c37-14026ca0a5ff" name="LM Cyber Kill Chain" number_of_phases="7" reference="http://www.lockheedmartin.com/content/dam/lockheed/data/corporate/documents/LM-White-Paper-Intel-Driven-Defense.pdf"><stixCommon:Kill_Chain_Phase name="Reconnaissance" ordinality="1" phase_id="stix:KillChainPhase-af1016d6-a744-4ed7-ac91-00fe2272185a"/><stixCommon:Kill_Chain_Phase name="Weaponization" ordinality="2" phase_id="stix:KillChainPhase-445b4827-3cca-42bd-8421-f2e947133c16"/><stixCommon:Kill_Chain_Phase name="Delivery" ordinality="3" phase_id="stix:KillChainPhase-79a0e041-9d5f-49bb-ada4-8322622b162d"/><stixCommon:Kill_Chain_Phase name="Exploitation" ordinality="4" phase_id="stix:KillChainPhase-f706e4e7-53d8-44ef-967f-81535c9db7d0"/><stixCommon:Kill_Chain_Phase name="Installation" ordinality="5" phase_id="stix:KillChainPhase-e1e4e3f7-be3b-4b39-b80a-a593cfd99a4f"/><stixCommon:Kill_Chain_Phase name="Command and Control" ordinality="6" phase_id="stix:KillChainPhase-d6dc32b9-2538-4951-8733-3cb9ef1daae2"/><stixCommon:Kill_Chain_Phase name="Actions on Objectives" ordinality="7" phase_id="stix:KillChainPhase-786ca8f9-2d9a-4213-b38e-399af4a2e5d6"/></stixCommon:Kill_Chain></stix:Kill_Chains></stix:TTPs></stix:STIX_Package>